<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ePOS Direct HTTPS Test - Print Commands</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .result { margin: 10px 0; padding: 10px; background: #f5f5f5; }
        .error { color: red; }
        .success { color: green; }
        button { padding: 10px 20px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>ePOS Direct HTTPS Test - Print Commands</h1>
    <p>Testing olika XML-format med faktiska print-kommandon</p>
    
    <div class="test-section">
        <h3>Test 1: Basic Print Command</h3>
        <button onclick="testFormat1()">Test Format 1</button>
        <div id="result1" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>Test 2: SOAP Wrapped Print</h3>
        <button onclick="testFormat2()">Test Format 2</button>
        <div id="result2" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>Test 3: Print with Parameters</h3>
        <button onclick="testFormat3()">Test Format 3</button>
        <div id="result3" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>Test 4: Complete Print Document</h3>
        <button onclick="testFormat4()">Test Format 4</button>
        <div id="result4" class="result"></div>
    </div>

    <script>
        const printerIP = '192.168.1.103';
        const endpoint = `https://${printerIP}/cgi-bin/epos/service.cgi`;
        
        async function testPrinterFormat(formatName, xmlData, headers = {}) {
            console.log(`üîÑ ${formatName}:`);
            console.log(xmlData);
            
            const defaultHeaders = {
                'Content-Type': 'application/soap+xml; charset=utf-8',
                'Accept': 'application/soap+xml, application/xml, text/xml',
                'SOAPAction': ''
            };
            
            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: { ...defaultHeaders, ...headers },
                    body: xmlData
                });
                
                const responseText = await response.text();
                console.log(`üì° ${formatName} response:`, responseText);
                
                if (responseText.includes('success="true"')) {
                    console.log(`‚úÖ ${formatName} SUCCESS!`);
                    return { success: true, response: responseText };
                } else {
                    const errorMatch = responseText.match(/code="([^"]+)"/);
                    const error = errorMatch ? errorMatch[1] : 'Unknown error';
                    console.log(`‚ùå ${formatName} fel:`, error);
                    return { success: false, error, response: responseText };
                }
            } catch (error) {
                console.log(`üí• ${formatName} exception:`, error);
                return { success: false, error: error.message };
            }
        }
        
        async function testFormat1() {
            const xml = `<?xml version="1.0" encoding="UTF-8"?>
<epos-print xmlns="http://www.epson-pos.com/schemas/2011/03/epos-print">
    <text>Hello World Test</text>
    <feed line="1"/>
    <cut/>
</epos-print>`;
            
            const result = await testPrinterFormat('Format 1 - Basic Print', xml);
            document.getElementById('result1').innerHTML = `
                <strong>Format 1 - Basic Print Command:</strong><br>
                ${result.success ? 
                    `<span class="success">‚úÖ SUCCESS! Print command accepted</span>` : 
                    `<span class="error">‚ùå ERROR: ${result.error}</span>`
                }<br>
                <small>Response: ${result.response}</small>
            `;
        }
        
        async function testFormat2() {
            const xml = `<?xml version="1.0" encoding="UTF-8"?>
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"
               xmlns:epos="http://www.epson-pos.com/schemas/2011/03/epos-print">
    <soap:Body>
        <epos:epos-print>
            <epos:text>SOAP Wrapped Test</epos:text>
            <epos:feed line="1"/>
            <epos:cut/>
        </epos:epos-print>
    </soap:Body>
</soap:Envelope>`;
            
            const result = await testPrinterFormat('Format 2 - SOAP Wrapped', xml);
            document.getElementById('result2').innerHTML = `
                <strong>Format 2 - SOAP Wrapped Print:</strong><br>
                ${result.success ? 
                    `<span class="success">‚úÖ SUCCESS! SOAP print command accepted</span>` : 
                    `<span class="error">‚ùå ERROR: ${result.error}</span>`
                }<br>
                <small>Response: ${result.response}</small>
            `;
        }
        
        async function testFormat3() {
            const xml = `<?xml version="1.0" encoding="UTF-8"?>
<epos-print xmlns="http://www.epson-pos.com/schemas/2011/03/epos-print">
    <text lang="sv" smooth="true">Moi Sushi Test</text>
    <feed line="2"/>
    <text align="center">Kvitto Test</text>
    <feed line="1"/>
    <cut type="feed"/>
</epos-print>`;
            
            const result = await testPrinterFormat('Format 3 - With Parameters', xml);
            document.getElementById('result3').innerHTML = `
                <strong>Format 3 - Print with Parameters:</strong><br>
                ${result.success ? 
                    `<span class="success">‚úÖ SUCCESS! Parametrized print accepted</span>` : 
                    `<span class="error">‚ùå ERROR: ${result.error}</span>`
                }<br>
                <small>Response: ${result.response}</small>
            `;
        }
        
        async function testFormat4() {
            const xml = `<?xml version="1.0" encoding="UTF-8"?>
<epos-print xmlns="http://www.epson-pos.com/schemas/2011/03/epos-print">
    <text>=============================</text>
    <feed line="1"/>
    <text align="center" width="2" height="2">MOI SUSHI</text>
    <feed line="1"/>
    <text>=============================</text>
    <feed line="1"/>
    <text>Test Order #12345</text>
    <feed line="1"/>
    <text>Datum: 2024-01-15 14:30</text>
    <feed line="2"/>
    <text>1x California Roll     120 SEK</text>
    <feed line="1"/>
    <text>1x Lax Nigiri         80 SEK</text>
    <feed line="1"/>
    <text>-----------------------------</text>
    <feed line="1"/>
    <text>Total:                200 SEK</text>
    <feed line="2"/>
    <text>Tack f√∂r ditt k√∂p!</text>
    <feed line="3"/>
    <cut/>
</epos-print>`;
            
            const result = await testPrinterFormat('Format 4 - Complete Receipt', xml);
            document.getElementById('result4').innerHTML = `
                <strong>Format 4 - Complete Print Document:</strong><br>
                ${result.success ? 
                    `<span class="success">‚úÖ SUCCESS! Complete receipt printed!</span>` : 
                    `<span class="error">‚ùå ERROR: ${result.error}</span>`
                }<br>
                <small>Response: ${result.response}</small>
            `;
        }
    </script>
</body>
</html> 