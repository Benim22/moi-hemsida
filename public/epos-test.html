<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ePOS Direct HTTPS Test - Device Formats</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .result { margin: 10px 0; padding: 10px; background: #f5f5f5; }
        .error { color: red; }
        .success { color: green; }
        button { padding: 10px 20px; margin: 10px 0; }
        .progress { color: blue; }
    </style>
</head>
<body>
    <h1>ePOS Direct HTTPS Test - Device Formats</h1>
    <p>Testing XML-format med device-specifikationer (DeviceNotFound ‚Üí beh√∂ver device!)</p>
    
    <div class="test-section">
        <h3>Test 1: SOAP med Device ID</h3>
        <button onclick="testFormat1()">Test Format 1</button>
        <div id="result1" class="result"></div>
        </div>
        
    <div class="test-section">
        <h3>Test 2: Print med Device Parameter</h3>
        <button onclick="testFormat2()">Test Format 2</button>
        <div id="result2" class="result"></div>
        </div>
        
    <div class="test-section">
        <h3>Test 3: EposDevice Format</h3>
        <button onclick="testFormat3()">Test Format 3</button>
        <div id="result3" class="result"></div>
        </div>
        
    <div class="test-section">
        <h3>Test 4: Simple Print Request</h3>
        <button onclick="testFormat4()">Test Format 4</button>
        <div id="result4" class="result"></div>
        </div>
        
    <div class="test-section">
        <h3>Test 5: Status Request</h3>
        <button onclick="testFormat5()">Test Format 5</button>
        <div id="result5" class="result"></div>
    </div>

    <script>
        const printerIP = '192.168.1.103';
        const endpoint = `https://${printerIP}/cgi-bin/epos/service.cgi`;
        
        async function testPrinterFormat(formatName, xmlData, headers = {}) {
            console.log(`üîÑ ${formatName}:`);
            console.log(xmlData);
            
            const defaultHeaders = {
                'Content-Type': 'application/soap+xml; charset=utf-8',
                'Accept': 'application/soap+xml, application/xml, text/xml',
                'SOAPAction': 'print'
            };
            
            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: { ...defaultHeaders, ...headers },
                    body: xmlData
                });
                
                const responseText = await response.text();
                console.log(`üì° ${formatName} response:`, responseText);
                
                if (responseText.includes('success="true"')) {
                    console.log(`‚úÖ ${formatName} SUCCESS!`);
                    return { success: true, response: responseText };
                } else {
                    const errorMatch = responseText.match(/code="([^"]+)"/);
                    const error = errorMatch ? errorMatch[1] : 'Unknown error';
                    console.log(`‚ùå ${formatName} fel:`, error);
                    return { success: false, error, response: responseText };
                }
            } catch (error) {
                console.log(`üí• ${formatName} exception:`, error);
                return { success: false, error: error.message };
            }
        }
        
        async function testFormat1() {
            const xml = `<?xml version="1.0" encoding="UTF-8"?>
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"
               xmlns:epos="http://www.epson-pos.com/schemas/2011/03/epos-print">
    <soap:Body>
        <epos:printRequest>
            <epos:devid>local_printer</epos:devid>
            <epos:epos-print>
                <epos:text>SOAP Device Test</epos:text>
                <epos:feed line="1"/>
                <epos:cut/>
            </epos:epos-print>
        </epos:printRequest>
    </soap:Body>
</soap:Envelope>`;
            
            const result = await testPrinterFormat('Format 1 - SOAP Device', xml);
            document.getElementById('result1').innerHTML = `
                <strong>Format 1 - SOAP med Device ID:</strong><br>
                ${result.success ? 
                    `<span class="success">‚úÖ SUCCESS! SOAP device print accepted</span>` : 
                    `<span class="error">‚ùå ERROR: ${result.error}</span>`
                }<br>
                <small>Response: ${result.response}</small>
            `;
        }
        
        async function testFormat2() {
            const xml = `<?xml version="1.0" encoding="UTF-8"?>
<epos-print xmlns="http://www.epson-pos.com/schemas/2011/03/epos-print" devid="local_printer">
    <text>Device Parameter Test</text>
    <feed line="1"/>
    <cut/>
</epos-print>`;
            
            const result = await testPrinterFormat('Format 2 - Device Parameter', xml);
            document.getElementById('result2').innerHTML = `
                <strong>Format 2 - Print med Device Parameter:</strong><br>
                ${result.success ? 
                    `<span class="success">‚úÖ SUCCESS! Device parameter accepted</span>` : 
                    `<span class="error">‚ùå ERROR: ${result.error}</span>`
                }<br>
                <small>Response: ${result.response}</small>
            `;
        }
        
        async function testFormat3() {
            const xml = `<?xml version="1.0" encoding="UTF-8"?>
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
    <soap:Body>
        <printjob xmlns="http://www.epson-pos.com/schemas/2011/03/epos-print">
            <devid>TM-T20III</devid>
            <printdata>
                <epos-print>
                    <text>EposDevice Test</text>
                    <feed line="1"/>
                    <cut/>
                </epos-print>
            </printdata>
        </printjob>
    </soap:Body>
</soap:Envelope>`;
            
            const result = await testPrinterFormat('Format 3 - EposDevice', xml);
            document.getElementById('result3').innerHTML = `
                <strong>Format 3 - EposDevice Format:</strong><br>
                ${result.success ? 
                    `<span class="success">‚úÖ SUCCESS! EposDevice format accepted</span>` : 
                    `<span class="error">‚ùå ERROR: ${result.error}</span>`
                }<br>
                <small>Response: ${result.response}</small>
            `;
        }
        
        async function testFormat4() {
            const xml = `<?xml version="1.0" encoding="UTF-8"?>
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
    <soap:Body>
        <print xmlns="http://www.epson-pos.com/schemas/2011/03/epos-print">
            <text>Simple Test</text>
            <feed line="1"/>
            <cut/>
        </print>
    </soap:Body>
</soap:Envelope>`;
            
            const result = await testPrinterFormat('Format 4 - Simple Print', xml);
            document.getElementById('result4').innerHTML = `
                <strong>Format 4 - Simple Print Request:</strong><br>
                ${result.success ? 
                    `<span class="success">‚úÖ SUCCESS! Simple print accepted</span>` : 
                    `<span class="error">‚ùå ERROR: ${result.error}</span>`
                }<br>
                <small>Response: ${result.response}</small>
            `;
        }
        
        async function testFormat5() {
            const xml = `<?xml version="1.0" encoding="UTF-8"?>
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
    <soap:Body>
        <status xmlns="http://www.epson-pos.com/schemas/2011/03/epos-print"/>
    </soap:Body>
</soap:Envelope>`;
            
            const result = await testPrinterFormat('Format 5 - Status', xml, {
                'SOAPAction': 'status'
            });
            document.getElementById('result5').innerHTML = `
                <strong>Format 5 - Status Request:</strong><br>
                ${result.success ? 
                    `<span class="success">‚úÖ SUCCESS! Status request accepted</span>` : 
                    `<span class="error">‚ùå ERROR: ${result.error}</span>`
                }<br>
                <small>Response: ${result.response}</small>
            `;
        }
    </script>
</body>
</html> 